<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alesha File Explorer</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .header {
            background-color: #24292e;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .upload-section {
            background-color: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .upload-form {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        .upload-form input, .upload-form button {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .upload-form button {
            background-color: #28a745;
            color: white;
            border: none;
            cursor: pointer;
        }
        .upload-form button:hover {
            background-color: #218838;
        }
        .breadcrumb {
            background-color: #e9ecef;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        .breadcrumb a {
            color: #007bff;
            text-decoration: none;
        }
        .file-list {
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .file-item {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
        }
        .file-item:last-child {
            border-bottom: none;
        }
        .file-item:hover {
            background-color: #f8f9fa;
        }
        .file-icon {
            margin-right: 10px;
            width: 24px;
            text-align: center;
        }
        .file-name {
            flex-grow: 1;
        }
        .file-size {
            color: #6c757d;
            font-size: 0.9em;
            margin-right: 10px;
        }
        .file-actions {
            display: flex;
            gap: 5px;
        }
        .file-actions button {
            padding: 4px 8px;
            border: 1px solid #ddd;
            border-radius: 3px;
            background-color: #f8f9fa;
            cursor: pointer;
            font-size: 0.8em;
        }
        .file-actions button:hover {
            background-color: #e9ecef;
        }
        .folder {
            font-weight: bold;
            color: #0366d6;
        }
        .file {
            color: #24292e;
        }
        a {
            text-decoration: none;
            color: inherit;
        }
        a:hover {
            text-decoration: underline;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #6c757d;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 20px;
            border-radius: 5px;
            width: 300px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üìÅ Alesha File Explorer</h1>
        <p>–§–∞–π–ª–æ–æ–±–º–µ–Ω–Ω–∏–∫ –Ω–∞ GitHub Pages</p>
    </div>

    <div class="upload-section">
        <h3>üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª</h3>
        <div class="upload-form">
            <input type="file" id="fileInput">
            <input type="text" id="fileName" placeholder="–ò–º—è —Ñ–∞–π–ª–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)">
            <button onclick="uploadFile()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤ —Ç–µ–∫—É—â—É—é –ø–∞–ø–∫—É</button>
        </div>
        <div id="uploadStatus" style="margin-top: 10px; font-size: 0.9em;"></div>
    </div>

    <div class="breadcrumb" id="breadcrumb">
        <a href="#" onclick="navigateTo('')">–ì–ª–∞–≤–Ω–∞—è</a>
    </div>

    <div class="file-list" id="fileList">
        <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>

    <div class="modal" id="authModal">
        <div class="modal-content">
            <h3>üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h3>
            <p>–î–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ –Ω—É–∂–µ–Ω GitHub Token</p>
            <input type="password" id="githubToken" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à GitHub Token" style="width: 100%; padding: 8px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px;">
            <button onclick="saveToken()" style="padding: 8px 16px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <p style="font-size: 0.8em; margin-top: 10px;">
                <a href="https://github.com/settings/tokens" target="_blank">–ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω</a> (–Ω—É–∂–Ω—ã –ø—Ä–∞–≤–∞ repo)
            </p>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        const OWNER = 'GeNLaSas-cell';
        const REPO = 'Alesha';
        let GITHUB_TOKEN = localStorage.getItem('github_token');
        
        // –¢–µ–∫—É—â–∏–π –ø—É—Ç—å
        let currentPath = '';

        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        function showAuthModal() {
            document.getElementById('authModal').style.display = 'block';
        }

        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω
        function saveToken() {
            const token = document.getElementById('githubToken').value;
            if (token) {
                localStorage.setItem('github_token', token);
                GITHUB_TOKEN = token;
                document.getElementById('authModal').style.display = 'none';
                alert('–¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑ URL
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        function navigateTo(path) {
            currentPath = path;
            updateBreadcrumb();
            loadDirectoryContents();
            // –û–±–Ω–æ–≤–ª—è–µ–º URL –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            const newUrl = window.location.origin + window.location.pathname + (path ? `?path=${encodeURIComponent(path)}` : '');
            window.history.pushState({ path }, '', newUrl);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ö–ª–µ–±–Ω—ã—Ö –∫—Ä–æ—à–µ–∫
        function updateBreadcrumb() {
            const breadcrumb = document.getElementById('breadcrumb');
            let html = '<a href="#" onclick="navigateTo(\'\')">–ì–ª–∞–≤–Ω–∞—è</a>';
            
            if (currentPath) {
                const parts = currentPath.split('/').filter(part => part);
                let accumulatedPath = '';
                
                parts.forEach((part, index) => {
                    accumulatedPath += (accumulatedPath ? '/' : '') + part;
                    html += ` / <a href="#" onclick="navigateTo('${accumulatedPath}')">${part}</a>`;
                });
            }
            
            breadcrumb.innerHTML = html;
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
        async function loadDirectoryContents() {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>';
            
            try {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º GitHub API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
                const apiUrl = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${currentPath}`;
                const response = await fetch(apiUrl);
                
                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');
                }
                
                const contents = await response.json();
                
                if (contents.length === 0) {
                    fileList.innerHTML = '<div class="file-item">–ü–∞–ø–∫–∞ –ø—É—Å—Ç–∞</div>';
                    return;
                }
                
                // –°–æ—Ä—Ç–∏—Ä—É–µ–º: —Å–Ω–∞—á–∞–ª–∞ –ø–∞–ø–∫–∏, –ø–æ—Ç–æ–º —Ñ–∞–π–ª—ã
                contents.sort((a, b) => {
                    if (a.type === b.type) {
                        return a.name.localeCompare(b.name);
                    }
                    return a.type === 'dir' ? -1 : 1;
                });
                
                let html = '';
                contents.forEach(item => {
                    const isDir = item.type === 'dir';
                    const icon = isDir ? 'üìÅ' : getFileIcon(item.name);
                    const size = isDir ? '' : `<span class="file-size">(${formatFileSize(item.size)})</span>`;
                    
                    html += `
                        <div class="file-item ${isDir ? 'folder' : 'file'}">
                            <span class="file-icon">${icon}</span>
                            <span class="file-name">
                                <a href="${isDir ? '#' : item.download_url}" ${isDir ? `onclick="navigateTo('${currentPath ? currentPath + '/' : ''}${item.name}')"` : 'target="_blank"'}>
                                    ${item.name}
                                </a>
                            </span>
                            <span class="file-size">${size}</span>
                            <div class="file-actions">
                                ${!isDir ? `<button onclick="deleteFile('${item.path}')">üóëÔ∏è</button>` : ''}
                            </div>
                        </div>
                    `;
                });
                
                fileList.innerHTML = html;
                
            } catch (error) {
                fileList.innerHTML = `<div class="file-item">–û—à–∏–±–∫–∞: ${error.message}</div>`;
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –Ω–∞ GitHub
        async function uploadFile() {
            if (!GITHUB_TOKEN) {
                showAuthModal();
                return;
            }

            const fileInput = document.getElementById('fileInput');
            const customFileName = document.getElementById('fileName').value;
            const statusElement = document.getElementById('uploadStatus');
            
            if (!fileInput.files[0]) {
                statusElement.innerHTML = '‚ùå –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏';
                statusElement.style.color = 'red';
                return;
            }

            const file = fileInput.files[0];
            const fileName = customFileName || file.name;
            const filePath = currentPath ? `${currentPath}/${fileName}` : fileName;

            statusElement.innerHTML = '‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...';
            statusElement.style.color = 'blue';

            try {
                const reader = new FileReader();
                reader.onload = async function(e) {
                    try {
                        // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º —Ñ–∞–π–ª –≤ base64
                        const content = btoa(String.fromCharCode.apply(null, new Uint8Array(e.target.result)));
                        
                        const response = await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/contents/${filePath}`, {
                            method: 'PUT',
                            headers: {
                                'Authorization': `token ${GITHUB_TOKEN}`,
                                'Accept': 'application/vnd.github.v3+json',
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                message: `Upload ${fileName}`,
                                content: content
                            })
                        });
                        
                        const result = await response.json();
                        
                        if (response.ok) {
                            statusElement.innerHTML = '‚úÖ –§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω!';
                            statusElement.style.color = 'green';
                            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                            fileInput.value = '';
                            document.getElementById('fileName').value = '';
                            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤
                            loadDirectoryContents();
                        } else {
                            throw new Error(result.message || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');
                        }
                    } catch (error) {
                        statusElement.innerHTML = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
                        statusElement.style.color = 'red';
                    }
                };
                
                reader.readAsArrayBuffer(file);
                
            } catch (error) {
                statusElement.innerHTML = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
                statusElement.style.color = 'red';
            }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        async function deleteFile(filePath) {
            if (!GITHUB_TOKEN) {
                showAuthModal();
                return;
            }

            if (!confirm(`–£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª ${filePath.split('/').pop()}?`)) {
                return;
            }

            try {
                // –°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∞–π–ª–µ —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å SHA
                const infoResponse = await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/contents/${filePath}`, {
                    headers: {
                        'Authorization': `token ${GITHUB_TOKEN}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (!infoResponse.ok) throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∞–π–ª–µ');
                
                const fileInfo = await infoResponse.json();
                
                // –¢–µ–ø–µ—Ä—å —É–¥–∞–ª—è–µ–º —Ñ–∞–π–ª
                const deleteResponse = await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/contents/${filePath}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `token ${GITHUB_TOKEN}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: `Delete ${filePath.split('/').pop()}`,
                        sha: fileInfo.sha
                    })
                });
                
                if (deleteResponse.ok) {
                    alert('–§–∞–π–ª —É–¥–∞–ª–µ–Ω!');
                    loadDirectoryContents();
                } else {
                    throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª');
                }
                
            } catch (error) {
                alert(`–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏: ${error.message}`);
            }
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∫–æ–Ω–∫–∏ –¥–ª—è —Ñ–∞–π–ª–∞ –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é
        function getFileIcon(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            const icons = {
                'txt': 'üìÑ', 'pdf': 'üìï', 'doc': 'üìò', 'docx': 'üìò',
                'xls': 'üìó', 'xlsx': 'üìó', 'ppt': 'üìì', 'pptx': 'üìì',
                'zip': 'üì¶', 'rar': 'üì¶', '7z': 'üì¶',
                'jpg': 'üñºÔ∏è', 'jpeg': 'üñºÔ∏è', 'png': 'üñºÔ∏è', 'gif': 'üñºÔ∏è',
                'mp3': 'üéµ', 'wav': 'üéµ', 'flac': 'üéµ',
                'mp4': 'üé¨', 'avi': 'üé¨', 'mkv': 'üé¨',
                'js': 'üìú', 'html': 'üåê', 'css': 'üé®',
                'exe': '‚öôÔ∏è', 'msi': '‚öôÔ∏è'
            };
            return icons[ext] || 'üìÑ';
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            // –ü–æ–ª—É—á–∞–µ–º –ø—É—Ç—å –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ URL
            const pathParam = getQueryParam('path');
            if (pathParam) {
                currentPath = pathParam;
            }
            
            updateBreadcrumb();
            loadDirectoryContents();
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" –≤ –±—Ä–∞—É–∑–µ—Ä–µ
            window.addEventListener('popstate', function(event) {
                if (event.state && event.state.path !== undefined) {
                    currentPath = event.state.path;
                    updateBreadcrumb();
                    loadDirectoryContents();
                }
            });
        });
    </script>
</body
